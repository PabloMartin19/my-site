---
title: "Informática forense"
date: 2025-01-29 19:00:00 +0000
categories: [Seguridad, Análisis]
tags: [Análisis]
author: pablo
description: "..."
toc: true
comments: true
image:
  path: /assets/img/posts/forense/portada.jpg
---

La informática forense es el conjunto de técnicas que nos permite obtener la máxima información posible tras un incidente o delito informático.

En esta práctica, realizarás la fase de toma de evidencias y análisis de las mismas sobre una máquina Linux y otra Windows. Supondremos que pillamos al delincuente in fraganti y las máquinas se encontraban encendidas. Opcionalmente, podéis realizar el análisis de un dispositivo Android.

Sobre cada una de las máquinas debes realizar el proceso de toma de evidencias siguiendo las directrices contenidas en RFC 3227(incluyendo un volcado de memoria y otro de disco duro), tomando las medidas necesarias para certificar posteriormente la cadena de custodia.

## Apartado A) Máquina Windows

### Volcado de disco duro en Windows

Comenzaremos realizando un volcado de disco duro en Windows, en concreto una máquina virtual con 30GB de disco. Este disco tiene registros e información necesarios para el caso práctico, pero tendremos que añadir otro disco del doble de tamaño (60GB) para hacer allí el volcado de información.

Algo muy a tener en cuenta es que estamos trabajando sobre un entorno que no es real, además, del poco tiempo para realizar la práctica. Por lo que lo recomendable es utilizar un disco cuanto más pequeño mejor, ya que de lo contrario puede tardar días en realizar el análisis. Evidentemente en un caso real pues los discos estarían mucho más llenos y el proceso tardaría más, pero en este caso lo haré así.

El volcado del disco duro con **FTK Imager** crea una copia exacta del almacenamiento de la máquina sin alterar su contenido. Esta imagen contiene todos los datos del sistema, incluyendo archivos, registros del sistema, historial de actividad y posibles rastros de malware. Este proceso es fundamental en el análisis forense, ya que permite examinar el estado del disco en un entorno seguro sin modificar la evidencia original.

Una vez dicho esto, tendremos que instalar la herramienta que utilizaremos para el volcado, existen muchas pero yo me he decantado por [AccessData FTK Imager](https://www.exterro.com/ftk-product-downloads/ftk-imager-4-7-3-81).

Después de instalarlo accedemos a la aplicación y comenzamos con el volcado, para ello seguimos los siguientes pasos:

1. Primero de todo le damos a "File" y seleccionamos la opción "Create Disk Image..."

    ![image](/assets/img/posts/forense/image1.png)

2. Elegimos como origen el disco físico de la máquina virtual, lo que nos permite capturar una copia exacta de su contenido.

    ![image](/assets/img/posts/forense/image2.png)

3. Seleccionamos ahora el disco desde el cual haremos el volcado.

    ![image](/assets/img/posts/forense/image3.png)

4. En este paso tendremos que especificar donde se va a realizar el volcado, para ello seleccionamos la opción "Add...", luego la primera opción Raw (dd), en la siguiente pestaña rellenamos datos meramente informativos y por último, elegimos el disco de destino donde se hará el volcado de datos.

    ![image](/assets/img/posts/forense/image4.png)

    ![image](/assets/img/posts/forense/image5.png)
    
    ![image](/assets/img/posts/forense/image6.png)

    ![image](/assets/img/posts/forense/image7.png)

5. Una vez configurado donde se realizará el volcado le damos a "Start".

    ![image](/assets/img/posts/forense/image8.png)


6. En donde nos saldrá una pestaña así con un progreso, el cual tardará unos 10 minutos.

    ![image](/assets/img/posts/forense/image9.png)

7. Durante el proceso también nos saldrá a lo último una verificación.

    ![image](/assets/img/posts/forense/image10.png)

8. Una vez terminado el volcado nos saldrá una pestaña con varios detalles, incluido el hash.

    ![image](/assets/img/posts/forense/image11.png)

9. También esta pestaña con una recopilación del volcado.

    ![image](/assets/img/posts/forense/image12.png)


Bien, pues ya habríamos terminado de esta forma el volcado de disco, para corroborar que se ha realizado con éxito nos podemos dirigir a "Archivos" y ver que el nuevo disco (Nuevo Vol (E:)) se ha llenado de información:

![image](/assets/img/posts/forense/image13.png)

Si accedemos a los archivos del disco donde hemos hecho el volcado, podemos ver todos estos ficheros:

![image](/assets/img/posts/forense/image14.png)

Básicamente lo que hace es fragmentar el disco en varios archivos para así poder dividir la imagen en partes más manejables. Esto es especialmente útil si el disco de destino tiene restricciones de tamaño de archivo.

### Volcado de memoria en Windows

Para el volcado de memoria utilizaré la misma herramienta que anteriormente, pues es un proceso muy sencillo y similar al de disco. 

Primero de todo seleccionamos de nuevo en "File" y pulsamos en "Capture Memory...".

![image](/assets/img/posts/forense/image15.png)

Nos saldrá una ventana en donde tendremos que seleccionar el disco E: como destino, además de marcar la casilla "Include page file".

![image](/assets/img/posts/forense/image16.png)

Le damos a "Capture Memory" y comenzará el proceso:

![image](/assets/img/posts/forense/image17.png)

Una vez terminado nos dirigimos de nuevo al disco para corroborar que se ha añadido los ficheros del volcado:

![image](/assets/img/posts/forense/image18.png)

### Volcado de registros en Windows

Ahora realizaré un volcado de registro, el cual consiste en extraer las bases de datos del Registro de Windows, donde se almacenan configuraciones del sistema, historial de actividad, credenciales y rastros de software o malware. 

Para ello, usamos la misma herramienta que los dos caso anteriores. En donde le tendremos que dar al icono amarillo de arriba:

![image](/assets/img/posts/forense/image19.png)

Se abrirá una pestaña y ahí tendremos que especificar la ruta del disco de destino, el cual es el mismo que en las dos anteriores:

![image](/assets/img/posts/forense/image20.png)

Comenzará el volcado de registro y una vez terminado, volvemos de nuevo al disco E: y vemos como se han generado nuevos ficheros:

![image](/assets/img/posts/forense/image21.png)

### Análisis disco con Autopsy

Una vez realizados los volcados del disco, memoria y registros, procederemos con el análisis forense utilizando [Autopsy](https://www.autopsy.com/download/). Autopsy es una herramienta gráfica que facilita la investigación y análisis de las evidencias recogidas, como las imágenes de disco, volcados de memoria y registros.

Una vez realizada la instalación, accedemos a la aplicación y nos saldrán diferentes opciones, nosotros marcamos "New Case":

![image](/assets/img/posts/forense/image22.png)

En la siguiente pestaña le damos un nombre al Caso y elegimos donde se guardará:

![image](/assets/img/posts/forense/image23.png)

En el siguiente paso rellenamos los datos meramente informativos:

![image](/assets/img/posts/forense/image24.png)

Una vez que hayamos creado el caso en Autopsy, la herramienta generará una base de datos que servirá como su estructura principal para el análisis. 

El siguiente paso será elegir la fuente de datos desde la cual se recopilará la información.

![image](/assets/img/posts/forense/image25.png)

Esta pestaña es muy importante, pues solo marcaremos las opciones que nos interesan, pues de lo contrario hará que el análisis tarde mucho más. Las opciones que yo he marcado son las siguientes:

![image](/assets/img/posts/forense/image26.png)

Le damos a "Finish" y en ese preciso momento comenzará el análisis:

![image](/assets/img/posts/forense/image27.png)

Como vemos se está empezando a recopilar información, este proceso puede tardar mucho dependiendo de muchas variables. En mi caso lo paré al 35% después de unas 4-5 horas, pues con lo que había recopilado ya era suficiente para lo que nos pide la práctica. 

![image](/assets/img/posts/forense/image28.png)


### Instalación Volatility3 en Debian 12

Volatility es una herramienta de análisis forense de memoria RAM que permite extraer información de volcados de memoria de sistemas Windows, Linux y macOS. Se usa para investigar incidentes de seguridad, detectar malware, recuperar datos y analizar procesos en ejecución. 

Por lo tanto, procedemos a su instalación la cual tendremos que bajarnos desde el repositorio:

```bash
pavlo@debian:~()$ git clone https://github.com/volatilityfoundation/volatility3.git
Clonando en 'volatility3'...
remote: Enumerating objects: 42556, done.
remote: Counting objects: 100% (346/346), done.
remote: Compressing objects: 100% (168/168), done.
remote: Total 42556 (delta 281), reused 195 (delta 178), pack-reused 42210 (from 3)
Recibiendo objetos: 100% (42556/42556), 8.38 MiB | 15.93 MiB/s, listo.
Resolviendo deltas: 100% (32743/32743), listo.
```

Accedemos al directorio del repositorio clonado y creamos un entorno virtual de Python para aislar la instalación:

```bash
pavlo@debian:~()$ cd volatility3/
pavlo@debian:~/volatility3(develop)$ python3 -m venv venv
pavlo@debian:~/volatility3(develop)$ source venv/bin/activate
```

En este punto, Volatility 3 no incluye un `requirements.txt`, ya que usa `pyproject.toml` para gestionar dependencias, por lo que ejecutamos el siguiente comando para la instalación: 

```bash
(venv) pavlo@debian:~/volatility3(develop)$ pip install .
Processing /home/pavlo/volatility3
  Installing build dependencies ... done
  Getting requirements to build wheel ... done
  Preparing metadata (pyproject.toml) ... done
Collecting pefile>=2024.8.26
  Downloading pefile-2024.8.26-py3-none-any.whl (74 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 74.8/74.8 kB 734.5 kB/s eta 0:00:00
Building wheels for collected packages: volatility3
  Building wheel for volatility3 (pyproject.toml) ... done
  Created wheel for volatility3: filename=volatility3-2.20.1-py3-none-any.whl size=912249 sha256=e2fe6f191532e493cc5e305d706c26e69f569b60bba6a6ff55bf73cf5e8f1760
  Stored in directory: /tmp/pip-ephem-wheel-cache-oo31pspy/wheels/5f/87/74/6ce43180018f0afedce648bb9388f6ff390d38822e323a4083
Successfully built volatility3
Installing collected packages: pefile, volatility3
Successfully installed pefile-2024.8.26 volatility3-2.20.1
```

Para comprobar que la instalación fue exitosa, ejecutamos el siguiente comando:

```bash
(venv) pavlo@debian:~/volatility3(develop)$ python3 vol.py -h
Volatility 3 Framework 2.20.1
usage: vol.py [-h] [-c CONFIG] [--parallelism [{processes,threads,off}]] [-e EXTEND] [-p PLUGIN_DIRS] [-s SYMBOL_DIRS] [-v] [-l LOG] [-o OUTPUT_DIR] [-q] [-r RENDERER]
              [-f FILE] [--write-config] [--save-config SAVE_CONFIG] [--clear-cache] [--cache-path CACHE_PATH] [--offline | -u URL] [--filters FILTERS]
              [--hide-columns [HIDE_COLUMNS ...]] [--single-location SINGLE_LOCATION] [--stackers [STACKERS ...]] [--single-swap-locations [SINGLE_SWAP_LOCATIONS ...]]
              PLUGIN ...
```

### Montaje del disco de Windows en Debian

Para la realización de las comprobaciones, necesitaremos utilizar distintas herramientas y entre ellas Volatility, la cual instalamos anteriormente. Por lo tanto, tendremos que montar el disco de Windows con el volcado en nuestra máquina física, el cual se encuentra en la ruta `/var/lib/libvirt/images/win10-1.qcow2`. Para ello seguiremos los siguientes pasos:

Primero, cargamos el módulo necesario para manejar discos en red con el siguiente comando:

```bash
(venv) pavlo@debian:~()$ sudo modprobe nbd
```

Luego, conectamos el archivo de imagen del disco virtual (en formato qcow2) a un dispositivo de bloque, utilizando qemu-nbd:

```bash
(venv) pavlo@debian:~()$ sudo qemu-nbd --connect=/dev/nbd0 /var/lib/libvirt/images/win10-1.qcow2
```

A continuación, listamos las particiones del disco con fdisk -l para verificar la estructura del disco y las particiones disponibles:

```bash
(venv) pavlo@debian:~()$ sudo fdisk -l /dev/nbd0
Disco /dev/nbd0: 60 GiB, 64424509440 bytes, 125829120 sectores
Unidades: sectores de 1 * 512 = 512 bytes
Tamaño de sector (lógico/físico): 512 bytes / 512 bytes
Tamaño de E/S (mínimo/óptimo): 512 bytes / 512 bytes
Tipo de etiqueta de disco: gpt
Identificador del disco: 479ABFDB-206B-403A-AF13-FEB3282C2C41

Disposit.   Comienzo     Final  Sectores Tamaño Tipo
/dev/nbd0p1       34     32767     32734    16M Reservado para Microsoft
/dev/nbd0p2    32768 125825023 125792256    60G Datos básicos de Microsoft
```

Esto nos muestra las particiones del disco, donde identificamos la partición de datos del sistema operativo. Posteriormente, creamos un directorio para montar la partición y proceder con el análisis:

```bash
(venv) pavlo@debian:~()$ sudo mkdir -p /mnt/windows
```

Montamos la partición de datos del disco en modo solo lectura:

```bash
(venv) pavlo@debian:~()$ sudo mount -o ro /dev/nbd0p2 /mnt/windows/
```

Ya montada la partición, podemos verificar que los archivos del sistema y los volcados de memoria están presentes con el comando:

```bash
(venv) pavlo@debian:~()$ ls /mnt/windows/
'$RECYCLE.BIN'       SAM                          Users                  VolcadoDisco.004   VolcadoDisco.009   VolcadoDisco.014   VolcadoDisco.019
 default             SECURITY                     VolcadoDisco.001       VolcadoDisco.005   VolcadoDisco.010   VolcadoDisco.015   VolcadoDisco.020
 DumpStack.log.tmp   software                     VolcadoDisco.001.txt   VolcadoDisco.006   VolcadoDisco.011   VolcadoDisco.016   VolcadoDisco.021
 memdump.mem         system                       VolcadoDisco.002       VolcadoDisco.007   VolcadoDisco.012   VolcadoDisco.017
 pagefile.sys       'System Volume Information'   VolcadoDisco.003       VolcadoDisco.008   VolcadoDisco.013   VolcadoDisco.018
```

Una vez que tenemos acceso al volcado de memoria (memdump.mem), utilizamos Volatility para analizarlo, ejecutando el siguiente comando:

```bash
(venv) pavlo@debian:~/volatility3(develop)$ python3 vol.py -f "/mnt/windows/memdump.mem" windows.info
Volatility 3 Framework 2.20.1
Progress:  100.00		PDB scanning finished                                                                                              
Variable	Value

Kernel Base	0xf8012be00000
DTB	0x1ad000
Symbols	file:///home/pavlo/volatility3/volatility3/symbols/windows/ntkrnlmp.pdb/89284D0CA6ACC8274B9A44BD5AF9290B-1.json.xz
Is64Bit	True
IsPAE	False
layer_name	0 WindowsIntel32e
memory_layer	1 FileLayer
KdVersionBlock	0xf8012ca0f3a0
Major/Minor	15.19041
MachineType	34404
KeNumberProcessors	2
SystemTime	2025-02-12 10:49:55+00:00
NtSystemRoot	C:\Windows
NtProductType	NtProductWinNt
NtMajorVersion	10
NtMinorVersion	0
PE MajorOperatingSystemVersion	10
PE MinorOperatingSystemVersion	0
PE Machine	34404
PE TimeDateStamp	Fri May 20 08:24:42 2101
```

### Comprobaciones

Para las siguiente comprobaciones utilizaré Volatility, CMD, PowerShell y RegistryViewer.

1. Procesos en ejecución.

    Con `PsList` enumeramos los procesos del sistema en el momento que se tomó el volcado de la memoria. Cada fila representa un proceso en el sistema, mostrando su ID, la ID del proceso padre, nombre de archivo, sesión, etc.

    ```bash
    python3 vol.py -f "/mnt/windows/memdump.mem" windows.pslist.PsList
    ```

    ![image](/assets/img/posts/forense/image30.png)

2. Servicios en ejecución.

    Mostramos una lista de servicios en el sistema, indicador y nombre del servicio:

    ```bash
    python vol.py -f "/mnt/windows/memdump.mem" windows.getservicesids.GetServiceSIDs
    ```

    ![image](/assets/img/posts/forense/image31.png)

3. Puertos abiertos.

    Muestra las conexiones de red actualmente establecidas, incluyendo los puertos en uso, las direcciones IP de origen y destino, los identificadores de proceso (PID) asociados y las marcas de tiempo correspondientes.

    ```bash
    python vol.py -f "/mnt/windows/memdump.mem" windows.netstat.NetStat
    ```

    ![image](/assets/img/posts/forense/image32.png)

4. Conexiones establecidas por la máquina.

    Muestra las conexiones de red activas en la máquina, incluyendo los protocolos utilizados, las direcciones IP de origen y destino, los puertos implicados, el estado de cada conexión, el usuario propietario y el identificador del proceso asociado.

    ```bash
    python vol.py -f "/mnt/forense/windows/memoria/memdump.mem" windows.netscan.NetScan
    ```

    ![image](/assets/img/posts/forense/image33.png)

5. Sesiones de usuario establecidas remotamente.

    Presenta las sesiones activas en el sistema en el instante en que se realizó el volcado, incluyendo la identificación de la sesión, su tipo, el identificador y nombre del proceso asociado, el usuario que la inició y la marca temporal correspondiente.

    ```bash
    python vol.py -f "/mnt/windows/memdump.mem" windows.sessions.Sessions
    ```

    ![image](/assets/img/posts/forense/image34.png)

6. Ficheros transferidos recientemente por NetBios.

    Dado que ni Autopsy ni Volatility ofrecen opciones directas para visualizar los archivos transferidos mediante NetBIOS, ejecutaremos el comando `nbtstat -n` en la misma máquina. Este comando nos permitirá ver la tabla de NetBIOS local en los adaptadores de red, mostrando los nombres registrados y su estado en la red.

    ![image](/assets/img/posts/forense/image36.png)

7. Contenido de la caché DNS.

    Ejecutaremos el comando `ipconfig /displaydns`, el cual nos permitirá visualizar los nombres de dominio y hosts que han sido resueltos recientemente, junto con sus direcciones IP correspondientes. Esta información puede ser útil para analizar conexiones previas establecidas por el sistema.

    ![image](/assets/img/posts/forense/image37.png)

8. Variables de entorno.

    Expondremos las variables de entorno del sistema en el momento del volcado, detallando el identificador y nombre del proceso asociado, la ubicación en memoria, el nombre de la variable y su valor correspondiente.

    ```bash
    python vol.py -f "/mnt/forense/windows/memoria/memdump.mem" windows.envars.Envars
    ```

    ![image](/assets/img/posts/forense/image35.png)

9. Dispositivos USB conectados

    En Autopsy, utilizando la opción **USB Device Attached**, podremos visualizar los dispositivos USB extraíbles que han sido conectados a la máquina en algún momento.

    ![image](/assets/img/posts/forense/image38.png)

10. Redes wifi utilizadas recientemente.

    Utilizando la herramienta **Registry Viewer**, podemos analizar el archivo **system** del registro de Windows y navegar hasta la ruta `system/ControlSet001/Control/Network/Connections`. En esta ubicación, encontramos claves del registro que contienen información sobre las redes Wi-Fi a las que se ha conectado la máquina.  

    ![image](/assets/img/posts/forense/image39.png)

11. Configuración del firewall de nodo.

    Para examinar la configuración de las reglas del firewall, utilizaremos Registry Viewer y abriremos el archivo system. Luego, navegaremos hasta la ruta:

    ```bash
    system\ControlSet001\Services\SharedAccess\Defaults\FirewallPolicy\FirewallRules
    ```

    Aquí encontraremos diversas reglas del firewall almacenadas en el registro de Windows. Por ejemplo, una regla destacada podría ser:

    ![image](/assets/img/posts/forense/image40.png)

12. Programas que se ejecutan en el Inicio.

    Abrimos nuevamente el archivo **software** y navegamos hasta la ruta:  

    `software\Microsoft\Windows\CurrentVersion\Run`  

    Aquí podemos ver los programas configurados para ejecutarse automáticamente al iniciar el sistema. En este caso, solo encontramos un antivirus integrado en el sistema que se inicia con Windows. Esta clave del registro es útil para identificar programas que se ejecutan al inicio, lo que puede ayudar en la detección de posibles **malware** o herramientas de administración remota ocultas.

    ![image](/assets/img/posts/forense/image41.png)

13. Asociación de extensiones de ficheros y aplicaciones.

    En el desplegable File Types, encontraremos una lista de diversas extensiones de archivo.

    ![image](/assets/img/posts/forense/image42.png)

    ![image](/assets/img/posts/forense/image43.png)

14. Aplicaciones usadas recientemente.

    Para ver las aplicaciones que se han utilizado en el sistema, podemos dirigirnos al artefacto **Run Programs**. 

    ![image](/assets/img/posts/forense/image44.png)

    Otra forma de ver las aplicaciones utilizadas es acceder al archivo de volcado del disco (dump) en la pestaña `Summary`, específicamente en la sección `User Activity`.

    ![image](/assets/img/posts/forense/image45.png)

15. Ficheros abiertos recientemente.

    Podemos verlo en el apartado **Recent Documents**.

    ![image](/assets/img/posts/forense/image46.png)

16. Software Instalado.

    Podemos ver el software instalado en el artefacto **Installed Programs**.

    ![image](/assets/img/posts/forense/image47.png)

17. Contraseñas guardadas.

    Las contraseñas guardadas las podemos ver en **Web Account Type**.

    ![image](/assets/img/posts/forense/image48.png)

18. Cuentas de Usuario

    Para ver las cuentas en **OS Accounts**.

    ![image](/assets/img/posts/forense/image49.png)

19. Historial de navegación y descargas. Cookies.

    Para ver el historial de navegación iremos a **Web History**.

    ![image](/assets/img/posts/forense/image50.png)

    Para ver las búsquedas en **Web Search**.

    ![image](/assets/img/posts/forense/image51.png)

    Las descargas en **Web Downloads**.

    ![image](/assets/img/posts/forense/image52.png)

    Las cookies en **Web Cookies**.

    ![image](/assets/img/posts/forense/image53.png)

20. Volúmenes cifrados

    Podemos verlos en la sección **Encryption Suspected**.

    ![image](/assets/img/posts/forense/image54.png)

21. Archivos con extensión cambiada.

    Para identificar los archivos que tienen una extensión cambiada o no adecuada, podemos acceder a la sección **Extension Mismatch Detected**.

    ![image](/assets/img/posts/forense/image55.png)

22. Archivos eliminados.

    Podemos ver los archivos eliminados en la sección **File Views** >> **Deleted Files** >> **File System**.

    ![image](/assets/img/posts/forense/image56.png)

23. Archivos Ocultos.

    Para encontrar los archivos **Hidden** debemos seleccionar justo el fichero y fijarnos en las Flags, donde indicará si está oculto o no:

    ![image](/assets/img/posts/forense/image57.png)

24. Archivos que contienen una cadena determinada.

    Para buscar una cadena debemos escribir la/s palabra/s en cuestión dentro de **Keyword Search**.

    ![image](/assets/img/posts/forense/image58.png)

25. Búsqueda de imágenes por ubicación.

    Para ver la ubicación de la imagen nos dirigimos al apartado **Geolocation** de arriba. Ahí nos movemos hacia la flecha y si pinchamos nos saldrá la imagen. 

    ![image](/assets/img/posts/forense/image60.png) 

    ![image](/assets/img/posts/forense/image59.png)

26. Búsqueda de archivos por autor.

    Para los archivos por autor vamos al artefacto **Metadata** y podemos ver que aparecen diferentes archivos y podemos ver el autor en el apartado de **Owner**.

    ![image](/assets/img/posts/forense/image61.png)


## Apartado B) Máquina Linux